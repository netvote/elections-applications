<div class="p-3">

  <h1>Build a Ballot</h1>
  <p>Build a ballot to use on Netvote apps.</p>

  <div class="row mt-5">

    <div class="col col-2  nv-builder__group-rail">
      
      <strong>Ballot Groups:</strong> 
      <ul class="list-unstyled">
        <li *ngFor="let group of myForm.get('bGroups').controls" >{{group.controls['bGroup'].value}}</li>
      </ul>

      <button (click)="addNewbGroup()" class="btn btn-primary btn-sm rounded text-light  mt-3">Add new Group</button>

    </div>

    <div class="col col-6  pl-4">

      <form [formGroup]="myForm">
    
        <!-- GROUPS -->
        <div formArrayName="bGroups">
          <div *ngFor="let bGroup of myForm.get('bGroups').controls; let i=index">

            <div [formGroupName]="i">

              <div class="form-group">

                <div class="d-flex  align-items-stretch  nv-builder-acc__header">

                    <div class="d-flex  align-items-center  nv-builder-acc__identifier  nv-builder-acc__identifier--group">
                      <div>Group</div>
                    </div>

                    <div class="nv-builder-acc__field">
                      <!-- <label for="ballotGroupTitle">Ballot Group Title</label><button class="btn btn-danger btn-large float-right" (click)="deleteBgroup(false, i)" title="Delete Group"><span class="oi oi-trash"></span></button> -->
                      <input formControlName="bGroup" type="text" class="form-control" placeholder="e.g., Secretary of State">
                    </div>

                </div>
                
              </div>
    
            
              <!-- SECTIONS -->
              <div formArrayName="sections">

                <nv-ballot-accordion>

                  <ngb-accordion #acc="ngbAccordion" [closeOthers]="true" [destroyOnHide]="false" activeIds="" (panelChange)="beforeChange($event)">

                      <ngb-panel *ngFor="let section of bGroup.get('sections').controls; let j=index" id="sectionPanel-{{j+1}}" [formGroupName]="j">

                          <ng-template ngbPanelTitle let-panelInfo="acc">

                            <!-- SECION HEADER -->
                            <div class="d-flex  align-items-stretch  nv-builder-acc__header">

                              <div class="d-flex  align-items-center  nv-builder-acc__identifier  nv-builder-acc__identifier--section">
                                <div>Section</div>
                              </div>
          
                              <div class="nv-builder-acc__field">
                                <input formControlName="sectionName" (focus)="testinput($event)" type="text" class="form-control  border-0  rounded-0" placeholder="e.g., Section Name">
                              </div>

                              <div class="d-flex  align-items-center  nv-builder-acc__toggle" (click)="panelInfo.toggle('sectionPanel-1')">
                                  <span class="oi oi-chevron-bottom"></span>
                              </div>
            
                            </div>

                            <button class="btn btn-danger btn-large nv-builder-acc__delete-section" (click)="deleteSection($event, bGroup.controls.sections, j)" title="Delete Section"><span class="oi oi-trash"></span></button>


                          </ng-template>
  
                          <ng-template ngbPanelContent>
                              
                            <div >
                              <!-- Section: {{section.controls['sectionName'].value}} -->

                              <!-- ITEMS -->
                              <div formArrayName="items" class="pt-0" class="nv-builder-acc__items">
              
                                <div *ngFor="let item of section.get('items').controls; let k=index">
                                 
                                  <div [formGroupName]="k">

                                    <!-- ITEM HEADER -->
                                    <div class="d-flex  align-items-stretch  nv-builder-acc__header  border-top-0">

                                      <div class="d-flex  align-items-center  nv-builder-acc__identifier  nv-builder-acc__identifier--item">
                                        <div>Item</div>
                                      </div>
                  
                                      <div class="nv-builder-acc__field">
                                        <input formControlName="itemName" type="text" class="form-control  border-0  rounded-0" placeholder="e.g., Section Name">
                                      </div>
                    
                                    </div>  


                                  </div>
                                 
                                </div>

                                <div class="nv-builder-acc__new-item" (click)="addNewItem(section.controls.items)">
                                    Add new item
                                </div>
              
                              </div>

                            </div>
                              
                          </ng-template>
                   
                      </ngb-panel>

                    </ngb-accordion>
            
                  </nv-ballot-accordion>
                  
                  <button (click)="addNewSection(bGroup.controls.sections)" class="btn btn-primary btn-sm rounded text-light  mt-3">Add Section</button>
                
              </div><br><hr>

            </div>
         
          </div>

        </div>
        
      </form>
    
      <br><pre>{{myForm.value | json}}</pre>


      <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

<!--- ORIGINAL WITH DYNAMIC FORMS LIB -->
      <form [formGroup]="formGroup" class="form-horizontal">

        <dynamic-bootstrap-form [group]="formGroup" [model]="formModel">

          <ng-template modelId="ballotGroups" let-group="group" let-context="context" let-index="index">

              <div class="d-flex  justify-content-end">

                <button type="button" class="btn btn-danger btn-sm rounded" (click)="removeItem(context, index)">Remove Group</button>
                <button *ngIf="index === context.groups.length - 1" type="button" class="btn btn-primary btn-sm rounded ml-2 text-light" (click)="insertItem(group, context, index + 1)">Add Group</button>
                  
              </div>
              
          </ng-template>

          <ng-template modelId="ballotSections" let-group="group" let-context="context" let-index="index">
            
            <div class="d-flex  justify-content-end">
              <button type="button" class="btn btn-danger btn-sm rounded" (click)="removeItem(context, index)">Remove Section</button>
              <button *ngIf="index === context.groups.length - 1" type="button" class="btn btn-primary btn-sm rounded ml-2 text-light" (click)="insertItem(group, context, index + 1)">Add Section</button>
            </div>

          </ng-template>

          <ng-template modelId="ballotItems" let-group="group" let-context="context" let-index="index">
            
            <div class="d-flex  justify-content-end">
                <button type="button" class="btn btn-danger btn-sm rounded" (click)="removeItem(context, index)">Remove Item</button>
                <button *ngIf="index === context.groups.length - 1" type="button" class="btn btn-primary btn-sm rounded ml-2 text-light" (click)="insertItem(group, context, index + 1)">Add Item</button>
            </div>
          </ng-template>

          <ng-template modelId="ballotInformation">

            <h5 class="mt-4">Ballot Groups</h5>

          </ng-template>

        </dynamic-bootstrap-form>

      </form>

      <div class="nv-builder__save">
        <button (click)="saveBallot()" class="btn  btn-large  btn-primary  text-light">Save Ballot</button>
        <button (click)="activateBallot()" class="btn  btn-large  btn-secondary">Activate Ballot</button>
        <button (click) = "testDelete(ballot)" class="btn btn-danger btn-large"><span class="oi oi-trash"></span></button>
      </div>

    </div>
    <!-- end row -->

    <div class="col col-4">

      <div class="mt-5">

        <div class="nv-mock">

          <div class="nv-mock__inner">

            <!-- <img src="/assets/phone-mock.svg"> -->

            <svg version="1.1" id="Layer_1" class="nv-svg-shadow" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
              x="0px" y="0px" viewBox="0 0 861 1732" enable-background="new 0 0 861 1732" xml:space="preserve">
              <g>
                <path display="none" fill="#686868" d="M838,1638.8c0,44.3-35.5,80.2-79.9,80.2H101c-44.5,0-81-35.9-81-80.2V93.2
                  C20,48.9,56.6,13,101,13h657c44.5,0,79.9,35.9,79.9,80.2V1638.8z" />
                <path fill="#333333" d="M757.1,0h-655C50.1,0,7,41.8,7,93v1546.2c0,51.2,43.1,92.7,95.2,92.7h655c52.1,0,93.9-41.5,93.9-92.7V93
                  C851,41.8,809.2,0,757.1,0z M804,1538H54V204h750V1538z" />

                <circle (click)="toggleShowJson()" title="Show JSON" fill="#222222" cx="429.7" cy="1626" r="61.6" />

                <path fill="#222222" d="M492,109c0,2.8-2.2,5-5,5H370c-2.8,0-5-2.2-5-5l0,0c0-2.8,2.2-5,5-5h117C489.8,104,492,106.2,492,109
                  L492,109z" />
                <circle fill="#222222" cx="429.4" cy="57.9" r="12.7" />
                <circle fill="#222222" cx="294.4" cy="110.3" r="14" />
                <path fill="#333333" d="M859,376h-8v122h8c1.4,0,2-1.1,2-2.5V378.5C861,377.1,860.4,376,859,376z" />
                <path fill="#333333" d="M7,219H5c-1.4,0-3,1.1-3,2.5v52.9c0,1.4,1.6,2.5,3,2.5h2V219z" />
                <path fill="#333333" d="M7,376H3c-1.4,0-3,1.1-3,2.5v116.9c0,1.4,1.6,2.5,3,2.5h4V376z" />
                <path fill="#333333" d="M7,536H3c-1.4,0-3,1.1-3,2.5v116.9c0,1.4,1.6,2.5,3,2.5h4V536z" />
              </g>
            </svg>

            <div class="nv-mock__preview">

              <div *ngIf="showJson" class="nv-mock__json">
                <pre>{{ formGroup.value | json }}</pre>
              </div>

              <div *ngIf="!showJson">

                <div class="nv-preview__header">

                  <div class="nv-preview__image" [style.background-image]="'url(' + formGroup.value.ballotImage + ')'"></div>

                  <div class="nv-preview__meta">

                    <div [ngClass]="{'nv-skeleton  nv-skeleton--light  nv-skeleton--100': !formGroup.value.ballotTitle}" class="nv-preview__title">
                      {{formGroup.value.ballotTitle}}
                    </div>

                    <div [ngClass]="{'nv-skeleton nv-skeleton--light  nv-skeleton--150': !formGroup.value.ballotLocation}" class="nv-preview__location">
                      {{formGroup.value.ballotLocation}}
                    </div>

                    <div [ngClass]="{'nv-skeleton nv-skeleton--thin  nv-skeleton--light  nv-skeleton--50': !formGroup.value.ballotDate}" class="nv-preview__date">
                      {{formGroup.value.ballotDate}}
                    </div>

                  </div>

                </div>

                <div class="nv-preview__groups">

                  <div *ngFor="let group of formGroup.value.ballotGroups" class="nv-preview__group">

                    <div class="nv-preview__group__title">
                      <span [ngClass]="{'nv-skeleton nv-skeleton--dark  nv-skeleton--150': !group.groupTitle}">&nbsp;{{group.groupTitle}}</span>
                    </div>

                    <div *ngFor="let section of group.ballotSections">

                      <div class="nv-preview__section__title">
                        <span [ngClass]="{'nv-skeleton nv-skeleton--light  nv-skeleton--150': !section.sectionTitle}">&nbsp;{{section.sectionTitle}}&nbsp;
                          <small *ngIf="section.sectionNote">({{section.sectionNote}})</small>
                        </span>
                      </div>

                      <div *ngFor="let item of section.ballotItems" class="nv-preview__item">

                        <div class="nv-preview__item__title">
                          <span [ngClass]="{'nv-skeleton nv-skeleton--light  nv-skeleton--150': !item.itemTitle}">&nbsp;{{item.itemTitle}}</span>
                        </div>

                        <div class="nv-preview__item__desc">
                          <span [ngClass]="{'nv-skeleton  nv-skeleton--thin  nv-skeleton--light  nv-skeleton--100': !item.itemDescription}">&nbsp;{{item.itemDescription}}</span>
                        </div>

                      </div>

                    </div>

                  </div>

                </div>

              </div>

            </div>
            <!-- Preview -->

          </div>

        </div>

      </div>

    </div>

  </div>

</div>